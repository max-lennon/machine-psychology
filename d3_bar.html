<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js. -->
<script src="https://d3js.org/d3.v6.js"></script>

<!-- Create a div where the graph will live -->
<div id="chart"></div>

<script>
    // Set the dimensions and margins of the graph
    const margin = {top:20, right:30, left:60, bottom:30},
    width = 700 - margin.left - margin.right,
    height = 600 - margin.top - margin.bottom;

    const svg = d3.select("#chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left}, ${margin.top})`);

    //Read in the data
    d3.csv("WHR_2016.csv", function(d){
        return {
            health: +d['Health (Life Expectancy)'],
            happiness_score: +d['Happiness Score'],
            economy: +d['Economy (GDP per Capita)'],
            region: d['Region'],
            country: d['Country']
        }
    }).then(function(data){
        // Add X Scale
        const x = d3.scaleBand()
                    .domain(data.map(d => d.country))
                    .range([0, width])
                    .padding(0.2);

        // Add Y Scale
        const y = d3.scaleLinear()
                    .domain([0, d3.max(data, d => d.happiness_score)])
                    .range([height, 0]);

        // Add Size Scale
        // const size = d3.scaleLinear()
        //             .domain([0, d3.max(data, d => d.economy)])
        //             .range([1, 15]);

        const color = d3.scaleOrdinal()
                    .domain(data.map(d => d.region))
                    .range(d3.schemeSet3)

        // var tooltip = d3.select("#chart")
        //                 .append("div")
        //                 .style("position", "absolute")
        //                 .style("visibility", "hidden")
        // Add axes
        svg.append("g")
            .attr("transform", `translate(0, ${height})`)
            .call(d3.axisBottom(x));

        svg.append("g")
            .call(d3.axisLeft(y));

        svg.append("g")
            .selectAll("bar")
            .data(data)
            .join("rect")
                .attr("x", function(d) { return x(d.country); })
                .attr("y", function(d) { return y(d.happiness_score); })
                .attr("width", function(d) {return x.bandwidth()})
                .attr("height", function(d) {return height - y(d.happiness_score)})
                .style("fill", function(d) { return color(d.region); })
                .style("opacity", 0.7)
                // .on("mouseover", function(e, d) { return tooltip
                //                                         .style("visibility", "visible")
                //                                         .style("font-family", "arial")
                //                                         .html("Country: " + d.country); })
                // .on("mousemove", function() { return tooltip
                //                                     .style("top", d3.select(this).attr("cy")+"px")
                //                                     .style("left", d3.select(this).attr("cx")+"px"); })
                // .on("mouseout", function() { return tooltip.style("visibility", "hidden"); })
    })

</script>