<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js. -->
<script src="https://d3js.org/d3.v6.js"></script>

<!-- Create a div where the graph will live -->
<div id="chart"></div>

<script>
    // Set the dimensions and margins of the graph
    const margin = {top:20, right:30, left:60, bottom:30},
    width = 700 - margin.left - margin.right,
    height = 600 - margin.top - margin.bottom;

    const svg = d3.select("#chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", `translate(${margin.left}, ${margin.top})`);

    //Read in the data
    d3.csv("WHR_2016.csv", function(d){
        return {
            health: +d['Health (Life Expectancy)'],
            happiness_score: +d['Happiness Score'],
            economy: +d['Economy (GDP per Capita)'],
            region: d['Region'],
            country: d['Country']
        }
    }).then(function(data){
        // Add X Scale
        const x = d3.scaleBand()
                    .domain(data.map(d => d.country))
                    .range([0, width])
                    .padding(0.2);

        // Add Y Scale
        const y = d3.scaleLinear()
                    .domain([0, d3.max(data, d => d.happiness_score)])
                    .range([height, 0]);

        // Add Size Scale
        // const size = d3.scaleLinear()
        //             .domain([0, d3.max(data, d => d.economy)])
        //             .range([1, 15]);

        const color = d3.scaleOrdinal()
                    .domain(data.map(d => d.region))
                    .range(d3.schemeSet3)

        // var tooltip = d3.select("#chart")
        //                 .append("div")
        //                 .style("position", "absolute")
        //                 .style("visibility", "hidden")
        // Add axes
        svg.append("g")
            .attr("transform", `translate(0, ${height})`)
            .call(d3.axisBottom(x));

        svg.append("g")
            .call(d3.axisLeft(y));

        svg.append("g")
            .selectAll("bar")
            .data(data)
            .join("rect")
                .attr("x", function(d) { return x(d.country); })
                .attr("y", function(d) { return y(d.happiness_score); })
                .attr("width", function(d) {return x.bandwidth()})
                .attr("height", function(d) {return height - y(d.happiness_score)})
                .style("fill", function(d) { return color(d.region); })
                .style("opacity", 0.7)
                // .on("mouseover", function(e, d) { return tooltip
                //                                         .style("visibility", "visible")
                //                                         .style("font-family", "arial")
                //                                         .html("Country: " + d.country); })
                // .on("mousemove", function() { return tooltip
                //                                     .style("top", d3.select(this).attr("cy")+"px")
                //                                     .style("left", d3.select(this).attr("cx")+"px"); })
                // .on("mouseout", function() { return tooltip.style("visibility", "hidden"); })
    })

    function postData(input) {
    $.ajax({
        type: "POST",
        url: "/script1.py",
        data: { param: input },
        success: callbackFunc
    });
    }

    function callbackFunc(response) {
        // do something with the response
        console.log(response);
    }

    postData("input");

</script>

<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

    <title>Hello, world!</title>
  </head>
  <body>
    <h1>Hello, world!</h1>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  </body>
</html>